<!DOCTYPE html>
<html layout:decorate="~{layout}">
    <head>
        <meta charset="UTF-8">

        <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
    </head>

    <body>
        <section class="layout-content" layout:fragment="corpo">
            <div class="container">
                <br/>
                <nav class="navbar navbar-expand-md bg-dark">
                    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item active">
                                <span class="tituloForm">Cadastrar Cliente</span>
                            </li>
                        </ul>
                    </div>

                    <a class="btn btn-primary btn-md" href="/cadastros/cliente/consultar" role="button">
                        <span class="oi oi-spreadsheet" title="Cadastro" aria-hidden="true"></span>
                        <span>Consultar Clientes</span>
                    </a>
                </nav>
                <br/>
                <br/>
<!--                 <div th:replace=""></div> -->

                <form class="form-horizontal" 
                      th:action = "${cliente.id == null} ? @{/cadastros/cliente/salvar} : @{/cadastros/cliente/editar}" 
                      th:object = "${cliente}"
                      method="POST" enctype="multipart/form-data">
                    <div class="form-group row">
                        <label for="nome" class="col-sm-2 control-label">Nome</label>
                        <div class="col-sm-7">
                            <input type="text" required class="form-control" id="txtnome" 
                                   placeholder="Digite nome do cliente" th:field = "*{nome}" >
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="endereco" class="col-sm-2 control-label">Endereço</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="rua" placeholder="Digite o endereço" th:field = "*{endereco}" >
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="endereco" class="col-sm-2 control-label">Bairro</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="bairro" placeholder="Digite o bairro" th:field = "*{bairro}">
                        </div>
                        <label for="numero" class="col-sm-1 control-label">Número</label>
                        <div class="col-sm-2">
                            <input type="text" class="form-control" id="numero" placeholder="Digite o número" th:field = "*{numero}">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="cidade" class="col-sm-2 control-label">Cidade</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id=cidade placeholder="Digite a cidade" th:field = "*{cidade}">
                        </div>
                        <div class="form-group row">
                            <label for="uf" class="col-sm-2 control-label">UF</label>
                            <div class="col-sm-8">
                                <select id="uf" class="form-control" th:field = "*{uf}">
                                    <option value="">UF</option>
                                    <option th:each = "uf : ${ufs}" th:value = "${uf}" th:text = "${uf}"></option>
                                </select>

                                <div class="invalid-feedback">

                                </div>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="cep" class="col-sm-2 control-label">Cep</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="cep" data-mask="00000-000"  placeholder="Digite o cep" th:field = "*{cep}">
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="email" class="col-sm-2 control-label">E-mail</label>
                        <div class="col-sm-5">
                            <input type="text" class="form-control" id="txtemail" placeholder="Digite o e-mail" th:field = "*{email}">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="telefone" class="col-sm-2 control-label">Telefone</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="txttelefone" placeholder="Digite o telefone" data-mask="(00)00000-0000" th:field = "*{telefone}" >
                        </div>
                    </div>

                    <div align="center" class="form-group">
                        <input type="hidden" id="id" th:field = "*{id}"/>
                        <button type="submit" class="btn btn-success">Salvar</button>
                    </div>

                </form>
            </div>
        </section>

        <script>
            $(document).ready(function() {
                
                $('#dataNascimento').datepicker({
                    showOthermonths:true,
                    format: 'yyyy-mm-dd'
                    });

                function limpa_formulário_cep() {
                    // Limpa valores do formulário de cep.
                    $("#rua").val("");
                    $("#bairro").val("");
                    $("#cidade").val("");
                    $("#uf").val("");
                    $("#ibge").val("");
                }
                
                //Quando o campo cep perde o foco.
                $("#cep").blur(function() {

                    //Nova variável "cep" somente com dígitos.
                    var cep = $(this).val().replace(/\D/g, '');

                    //Verifica se campo cep possui valor informado.
                    if (cep != "") {

                        //Expressão regular para validar o CEP.
                        var validacep = /^[0-9]{8}$/;

                        //Valida o formato do CEP.
                        if(validacep.test(cep)) {

                            //Preenche os campos com "..." enquanto consulta webservice.
                            $("#rua").val("...");
                            $("#bairro").val("...");
                            $("#cidade").val("...");
                            $("#uf").val("...");
                            $("#ibge").val("...");

                            //Consulta o webservice viacep.com.br/
                            $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {

                                if (!("erro" in dados)) {
                                    //Atualiza os campos com os valores da consulta.
                                    $("#rua").val(dados.logradouro);
                                    $("#bairro").val(dados.bairro);
                                    $("#cidade").val(dados.localidade);
                                    $("#uf").val(dados.uf);
                                    $("#ibge").val(dados.ibge);
                                } //end if.
                                else {
                                    //CEP pesquisado não foi encontrado.
                                    limpa_formulário_cep();
                                    alert("CEP não encontrado.");
                                }
                            });
                        } //end if.
                        else {
                            //cep é inválido.
                            limpa_formulário_cep();
                            alert("Formato de CEP inválido.");
                        }
                    } //end if.
                    else {
                        //cep sem valor, limpa formulário.
                        limpa_formulário_cep();
                    }
                });
            });
    </script>
    </body>
</html>
